[K8s-101] Steps to generates TLS keys for K8s infrastructure

In general, following 3 steps:
Generates key
openssl genrsa -out ca.key 2048
Certificate signing request
openssl req -x509 -new -nodes -key ca.key -subj "/CN=${MASTER_IP}" -days 10000 -out ca.crt
Sign certificates
openssl req -new -key server.key -out ca.crt -config csr.conf
openssl req -in -key server.key -out ca.crt -config csr.conf
Specifically for K8s,
Create CA Certificate
Create components certificate and use CA certificate to sign them
Create certificates for worker nodes.


——————
1. Create CA Certificate
openssl genrsa -out ca.key 2048

openssl req -new -key ca.key -subj “/CN=KUBERNETES-CA” -out ca.csr

openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt # Self sign since it’s CA

2. Create components Certificate and use CA certificate to sign them

Create admin pairs
openssl genrsa -out admin.key 2048

openssl req -new -key admin.key -subj “/
CN=kube-admin/O=system:masters” -out admin.csr

openssl x509 -req -in admin.csr -CA ca.crt -CAKey ca.key -out admin.crt #

Create kube-scheduler pairs

openssl genrsa -out kube-scheduler.key 2048

openssl req -new -key ca.key -subj “/CN=system.kube-scheduler” -out kube-scheduler.csr

openssl req -new -key admin.key -subj “/
CN=system.kube-scheduler” -out kube-scheduler.csr

3. Create certificates for worker nodes
with name of: system:node:node01
with group of system:nodes

—
References

Docs links:
https://kubernetes.io/docs/concepts/cluster-administration/certificates/#openssl